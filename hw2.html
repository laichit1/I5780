<!DOCTYPE html>
<html>
<head>
<style>
#info {
  position: absolute;
  top: 0px;
  width: 100%;
  padding: 10px;
  text-align: center;
  color: #ffff00
}

body {
  overflow: hidden;
}
</style>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>


<audio id="collisionsound" style="display:none">
<source src="collision3.wav" type='audio/wav'>
</audio>
</head>

<body>
<script>
	var str;
class Particle {
	colour(){
  	str = '#';
    var aryNum = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F"];
    for (var i = 0; i < 6; i++) {
      str += aryNum[parseInt(Math.random() * 16)];
    
    }
  }
  constructor(mesh) {
    this.pos = new THREE.Vector3()
    this.vel = new THREE.Vector3()
    this.force = new THREE.Vector3(0, 0, 0)
    this.mesh = mesh;

    this.light = new THREE.PointLight(str, 1, 100)
    scene.add(this.light)
    scene.add(mesh) // add to scene when particle is created
  }
  update(dt) {
    this.vel.add(this.force.clone().multiplyScalar(dt))
    this.pos.add(this.vel.clone().multiplyScalar(dt))

    // simple plane collision at y = -25
    if (this.pos.z > 100 - 10) {
      this.pos.z = 100 - 10;
      this.vel.z = -0.9 * this.vel.z;
      collisionSound.play();
    }
    if (this.pos.z < -100 + 10) {
      this.pos.z = -100 + 10;
      this.vel.z = -0.9 * this.vel.z;
      collisionSound.play();
    }
    if (this.pos.x > 100 - 10) {
      this.pos.x = 100 - 10;
      this.vel.x = -0.9 * this.vel.x;
      collisionSound.play();
    }
    if (this.pos.x < -100 + 10) {
      this.pos.x = -100 + 10;
      this.vel.x = -0.9 * this.vel.x;
      collisionSound.play();
    }
    this.mesh.position.copy(this.pos)
    this.light.position.copy(this.pos)
    this.light.position.y += 15
  }

}

var camera, scene, renderer;

init();
animate();

function init() {
	collisionSound = document.getElementById ('collisionsound');
  scene = new THREE.Scene();
  particle = new Particle();
  camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
  camera.position.set(0, 200, 300);
  camera.lookAt(new THREE.Vector3());
  scene.add(camera);
  let light = new THREE.PointLight(0xffffff);
  light.position.set(100, 300, 200);
  scene.add(light);

  let gridXZ = new THREE.GridHelper(200, 20, 'red', 'white');
  //scene.add(gridXZ);

  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0x888888);

  let controls = new THREE.OrbitControls(camera, renderer.domElement);

  document.body.appendChild(renderer.domElement);
  ////////////////////////////////////////////////////////////////////////

  var geometry = new THREE.BoxGeometry(220, 5, 10);
  var material = new THREE.MeshPhongMaterial();

  let mesh = new THREE.Mesh(geometry, material);
  mesh.position.z = 105
  scene.add(mesh);

  let mesh2 = mesh.clone()
  mesh2.position.z = -105
  scene.add(mesh2)

  let mesh3 = mesh.clone()
  mesh3.position.x = 105;
  mesh3.position.z = 0;
  mesh3.rotateY(Math.PI / -2);
  scene.add(mesh3)

  let mesh4 = mesh.clone()
  mesh4.position.z = 0;
  mesh4.position.x = -105;
  mesh4.rotateY(Math.PI / -2);
  scene.add(mesh4)

  let puckMesh = new THREE.Mesh(new THREE.CylinderGeometry(10, 10, 6, 32), new THREE.MeshLambertMaterial({color: 0x888888,emissive: particle.colour()}))
    puck = new Particle(puckMesh)
    puck.vel.set(20, 0, -10)
    puck.pos.y = 3
    
    let puck1Mesh = new THREE.Mesh(new THREE.CylinderGeometry(10, 10, 6, 32), new THREE.MeshLambertMaterial({color: 0x888888,emissive: particle.colour()}))
    puck1 = new Particle(puck1Mesh)
    puck1.vel.set(-20, 0, 10)
    puck1.pos.y = 3
    
    



  let floor = new THREE.Mesh(new THREE.PlaneGeometry(200, 200),
    new THREE.MeshPhongMaterial({color: 0x888888}))
  scene.add(floor)
  floor.rotation.x = -Math.PI / 2

}

function animate() {
  puck.update(0.1)
  puck1.update(0.1)
 	//console.log(puck.pos.x);
  //console.log(puck1.pos.x);
  //console.log(puck.pos.z);
  //console.log(puck1.pos.z);
  requestAnimationFrame(animate);
  render();
}

function render() {
  renderer.render(scene, camera);
}

</script>
</body>

</html>